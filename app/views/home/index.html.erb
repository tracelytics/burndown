<div class="content"></div>

<!-- Templates -->
<script type="text/template" id="tmpl_repo">
<% if current_user %>
    <div class="form-inline">
        <input type="text" class="input-large" placeholder="github 'user/repo'" autofocus>
        <button id="fetch" type="submit" class="btn">View Repository</button>
        <p>
            <span data-beforeicon="&#xe054;">Type a GitHub username/repository that you have access to.</span>
        </p>
    </div>
<% else %>
    <section class="right">
        <h3>
            Ok, how does it work?
        </h3>
        <ol>
            <li><span>Sign in with GitHub to Burndown:</span>
                <ul>
                    <li><%= link_to "your private & public repos", "/auth/github?scope=repo" %></li>
                    <li><%= link_to raw("just public repos <small>(read only)</small>"), "/auth/github" %></li>
                </ul>
            </li>
            <li><span>Search for your repos and milestone</span></li>
            <li><span>View burn down charts and lists of open and closed issues</span></li>
            <li><span>??</span></li>
            <li><span>Burndown before you burn out</span></li>
        </ol>
    </section>

    <section class="left">
        <h3>
            What is this?
        </h3>
        <p>
            At <a href="http://dev.appneta.com" title="Appneta Design and Development" target="_blank">AppNeta</a>, we wanted a way to see
            how we are doing on closing issues in our milestones.
            <br>
            We put together a service to see if we were going to finish on time.
            We figured this might be useful for others, so we put it on the interwebs, through a <a href="http://en.wikipedia.org/wiki/Series_of_tubes" title="fail">series of tubes</a>.
        </p>
    </section>

    <section class="right">
        <h3>
            Is it safe to sign in to GitHub?
        </h3>
        <p>
            Sure, we don’t store any of your credentials. We just use the info to query the GitHub API to look up your repos and milestones.
            We never store anything, <a href="https://github.com/settings/applications">revoke access</a> any time you want.
        </p>
    </section>

    <section class="left">
        <h3>
            Wait, what’s a burn down chart?
        </h3>
        <p>
            A burn down chart is a representation of work left to do versus time.
            <br>
            The outstanding work is on the y-axis, with time along the x-axis.
            <br>
            <a href="http://en.wikipedia.org/wiki/Burn_down_chart" title="Thanks Wikipedia" target="_blank"><small>Thanks Wikipedia!</small></a>
        </p>
    </section>

    <section class="left">
        <h3>
            Can I contribute?
        </h3>
        <p>
            Sure! Take a look at the project on <a href="https://github.com/appneta/burndown" title="view on GitHub">GitHub</a>, submit a pull request,
            file an issue, contribute anyway you want.
        </p>
        <a href="https://github.com/appneta/burndown" title="view on GitHub" class="to_github">Check out the project on GitHub</a>
    </section>
<% end %>

{{ if (message.has('title')) { }}
    <div class="error">
        <span data-beforeicon="&#xe010;">{{=message.get('text')}}</span>
    </div>
{{ } else { }}
    {{ if (session.has('owner') && session.has('repo')) { }}
    <div class="milestones">
        <h3>
            <a href="#{{=session.getURL()}}/milestones/{{=adverseState}}">{{=stateFormatted}}</a>
            Milestones in {{=session.getURL()}}
        </h3>
        {{ if (milestones.length > 0) { }}
        <ul>
        {{ _.each(milestones, function (milestone, i) { }}
            <li>
                <a href="#{{=session.getURL()}}/{{=milestone.get('number')}}" title="{{=milestone.get('title')}}">
                    {{=milestone.get('title')}}

                    <span>
                        <strong>{{=milestone.get('open_issues')}}</strong>
                        +
                        {{=milestone.get('closed_issues')}}
                        =
                        {{=milestone.getNumIssues()}}
                    </span>
                </a>
            </li>
        {{ }); }}
        </ul>
        {{ } else { }}
        <div class="error">
            <span data-beforeicon="&#xe010;">This repository has no milestones!</span>
        </div>
        {{ } }}
        <h3>Overview</h3>
        <ul>
            <li>
                <a href="#{{=session.getURL()}}/summary">30 Day Summary</a>
            </li>
            <li>
                <a href="#{{=session.getURL()}}/summary/60">60 Day Summary</a>
            </li>
            <li>
                <a href="#{{=session.getURL()}}/summary/90">90 Day Summary</a>
            </li>
        </ul>
    </div>
    {{ } }}
{{ } }}
</script>

<script type="text/template" id="tmpl_milestone">
    <div class="milestone">
        <a href="#{{=session.getURL()}}" class="back" title="back to list of milestones">Back</a>

        <div class="meta_issues">
            <h3>
                {{=milestone.get('title')}}
                <span>{{=session.getURL()}}</span>
                {{ if (milestone.has('due_on')) { }}
                    <small class="duration">[{{=milestone.getMilestoneLength()}} long burndown]</small>
                {{ } }}
            </h3>
            <div class="due_date{{ if (!milestone.has('due_on')) { }} nodate{{ } }}">
                {{ if (milestone.has('due_on')) { }}
                    {{ if (milestone.isDueToday()) { }}
                        <span data-beforeicon="&#xe009;" class="overdue">
                            warning! milestone is due today!
                        </span>
                    {{ } else if (milestone.isPastDueDate()) { }}
                        <span data-beforeicon="&#xe009;" class="overdue">
                            danger! milestone was
                            <br>
                            due {{=milestone.getDueDateFormatted()}}
                        </span>
                    {{ } else { }}
                        <span data-beforeicon="&#xe009;">
                            due {{=milestone.getDueDateFormatted()}}
                            <br>
                            in about {{=milestone.getMilestoneCountdown()}}
                        </span>
                    {{ } }}
                {{ } else { }}
                <span data-beforeicon="&#xe015;">
                    no due date!
                    <a target="_blank" href="{{=milestone.getEditLink()}}" title="Add a due date for this milestone to properly burn-it-down">admins, add one!</a>
                </span>
                {{ } }}
            </div>
        </div>
        <div class="created">
            {{=milestone.getCreator()}} created milestone on {{=milestone.getCreatedDateFormatted()}}
        </div>
        <div class="issue_math">
            <span class="jump">
                <a href="#open-issues" title="view open issues" data-inpage="true">{{=milestone.get('open_issues')}}</a> <small>[open]</small>
            </span>
            <span class="join">+</span>
            <span class="jump">
                <a href="#closed-issues" title="view closed issues" data-inpage="true">{{=milestone.get('closed_issues')}}</a> <small>[closed]</small>
            </span>
            <span class="join">=</span>
            <span>{{=milestone.getNumIssues()}}</span>
        </div>
        <ul class="completeness">
            <li>total</li>
            <li style="width:{{=milestone.getPercentComplete()}}%;"></li>
            <li>{{=milestone.getPercentComplete()}}%</li>
        </ul>
        <div class="chart_wrapper">
        {{ if (milestone.get('closed_issues') > 0) { }}
            <div id="chart_container">
                <div id="y_axis"></div>
                <div id="chart"></div>
            </div>
        {{ } else { }}
            <h2>~ A Burndown Haiku ~</h2>
            <p>
            without closing issues
            <br>
            there can be no GitHub peace
            <br>
            open&nbsp;&raquo;&nbsp;closed is the way
            </p>
        {{ } }}
            <div id="legend"></div>
        </div>
        <div class="date_picker_wrapper">
            Start Date:
            <input class="datepicker">
        </div>
    </div>

    <div class="issues_wrapper">
        <div id="open-issues">
            <h3>
                Open Issues
                <small id="open-issues-count"></small>
            </h3>
            <span class="legend" data-beforeicon="&#xe009;">open</span>
            <div class="open"></div>
        </div>
        <div id="closed-issues">
            <h3>
                Closed Issues
                <small id="closed-issues-count"></small>
            </h3>
            <span class="legend" data-beforeicon="&#xe009;">open</span>
            <div class="closed"></div>
        </div>
        <ul class="labels"></ul>
    </div>
</script>

<script type="text/template" id="tmpl_labels">
    {{ _.each(labels, function (label, i) { }}
        <li>{{=label.createLink()}}</li>
    {{ }); }}
</script>

<script type="text/template" id="tmpl_issues">
    <ul{{ if (issues.length === 0) { }} class="empty"{{ } }}>
        {{ _.each(issues, function (issue, i) { }}
            <li data-labels="{{=issue.getLabelString()}}">
                {{=issue.createLink()}}
            </li>
        {{ }); }}
        <li class="empty_open">
            <h2>~ A Burndown Haiku ~</h2>
            <p>
                when none are open
                <br>
                the Burndown has been vanquished
                <br>
                the GitHub abides
            </p>
        </li>
        <li class="empty_closed">
            <h2>~ A Burndown Haiku ~</h2>
            <p>
                empty retains shape
                <br>
                when closed is its structure type
                <br>
                commits truly void
            </p>
        </li>
    </ul>
</script>

<script type="text/template" id="tmpl_loading">
    <div>
        <img src="assets/burndown_dance.gif" alt="Fetching Issues from GitHub" class="loading" />
    </div>
</script>

<script type="text/template" id="tmpl_error">
    <div class="errors">
        <h4>Error!</h4>
        {{=error.message}}
    </div>
</script>

<script type="text/template" id="tmpl_summary">
    <div class="summary">
        <a href="#{{=session.getURL()}}" class="back" title="back to repository">Back</a>
        <div class="meta_issues">
            <h3>
                {{=days}} Day Summary
                <span>{{=session.getURL()}}</span>
            </h3>
        </div>
        {{ if (loaded && (newest.length > 0 || closed.length > 0)) { }}
        <div class="issue_math">
            <span class="jump">
                <a href="#closed-issues" title="view open issues" data-inpage="true">{{=closed.length}}</a> <small>[closed]</small>
            </span>
            <span class="join">{{ if (closed.length > newest.length) { }}>{{ } else if (closed.length === newest.length) { }}={{ } else { }}<{{ } }}</span>
            <span class="jump">
                <a href="#open-issues" title="view closed issues" data-inpage="true">{{=newest.length}}</a> <small>[new]</small>
            </span>
            <span class="join">=</span>
            <span class="eval">
                {{ if (closed.length > newest.length) { }}
                <span class="burning">on fire!</span>
                {{ } else if (closed.length === newest.length) { }}
                breakin’ even
                {{ } else { }}
                <span class="coldasice">get closin’</span>{{ } }}
            </span>
        </div>
        {{ } }}
    {{ if (loaded) { }}
        <div class="chart_wrapper">
            <div id="chart_container">
                <div id="y_axis"></div>
                <div id="chart"></div>
            </div>
            <div id="legend"></div>
        {{ if (newest.length === 0 || closed.length === 0) { }}
            <div class="empty_chart">
                Not enough issues to draw a graph! =(
            </div>
        {{ } }}
        </div>
    {{ } else { }}
        <div class="loading">
            loading...
        </div>
        <dl class="progress">
            <dt>Fetching Issues&hellip;</dt>
            <dd>
                <span style="width: {{=progress}}%;">
                    {{=progress}}%
                </span>
            </dd>
        </dl>
    {{ } }}
   </div>
   {{ if (loaded) { }}
    <div class="issues_wrapper">
        <div id="open-issues">
            <h3>New Issues <small>[{{=newest.length}}]</small></h3>
            <span class="legend" data-beforeicon="&#xe009;">open</span>
            <div class="open"></div>
        </div>

        <div id="closed-issues">
            <h3>Closed Issues <small>[{{=closed.length}}]</small></h3>
            <span class="legend" data-beforeicon="&#xe009;">open</span>
            <div class="closed"></div>
        </div>
    </div>
    {{ } }}
</script>
